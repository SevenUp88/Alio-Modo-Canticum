<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misatango - Alio Modo Canticum</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <style>
        :root {
            --background-start: #1e1e2f; --background-end: #121212;
            --card-bg: rgba(30, 30, 46, 0.5); --accent-color: #A78BFA;
            --primary-text-color: #E0E0E0; --secondary-text-color: #A0A0A0;
            --border-color: rgba(255, 255, 255, 0.1);
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        html { color-scheme: dark; scroll-behavior: smooth; }
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-image: linear-gradient(180deg, var(--background-start), var(--background-end));
            background-attachment: fixed;
            color: var(--primary-text-color); margin: 0; padding: 24px;
            display: flex; flex-direction: column; align-items: center;
        }
        .container { width: 100%; max-width: 720px; }
        .header-logo { display: block; margin: 0 auto 30px auto; width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent-color); padding: 5px; background-color: var(--card-bg); }
        .main-title { color: #FFFFFF; text-align: center; font-size: 2.5em; margin-bottom: 5px; font-weight: 700; letter-spacing: -1px; }
        .concert-location { text-align: center; color: var(--secondary-text-color); margin-top: 0; margin-bottom: 25px; font-size: 1.1em; font-style: italic; }
        .concert-info { text-align: center; margin-bottom: 20px; padding: 20px; background-color: var(--card-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 16px; border: 1px solid var(--border-color); }
        .concert-info p { margin: 8px 0; font-size: 1em; } .concert-info strong { font-weight: 700; color: var(--accent-color); margin-right: 5px; }

        .playlist-controls-wrapper { margin: 20px 0 40px 0; padding: 15px; background-color: var(--card-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 99px; border: 1px solid var(--border-color); }
        .playlist-controls { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .playlist-controls button { background: transparent; border: none; color: var(--primary-text-color); width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; }
        .playlist-controls button svg { width: 22px; height: 22px; fill: currentColor; }
        .playlist-controls button:hover { background-color: rgba(255, 255, 255, 0.1); }
        #playlist-play-pause { width: 56px; height: 56px; background-color: var(--accent-color); color: #121212; }
        #playlist-play-pause:hover { background-color: #c4b5fd; transform: scale(1.05); }

        .brano {
            background: var(--card-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 2px solid transparent; border-radius: 20px; padding: 24px; margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37); transition: all 0.4s ease;
            opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease-out forwards;
        }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .brano.is-playing { border-color: var(--accent-color); box-shadow: 0 0 30px 5px rgba(167, 139, 250, 0.25); }
        .brano h2 { margin-top: 0; font-size: 1.6em; color: #FFFFFF; font-weight: 700; margin-bottom: 24px; }
        
        audio { display: none; } /* Player audio originale nascosto */
        .custom-player { display: flex; align-items: center; gap: 15px; width: 100%; margin-bottom: 24px; }
        .play-pause-btn { background: transparent; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; }
        .play-pause-btn svg { width: 36px; height: 36px; fill: var(--accent-color); transition: transform 0.2s ease; }
        .play-pause-btn:hover svg { transform: scale(1.1); }
        .player-center { flex-grow: 1; display: flex; flex-direction: column; gap: 8px; }
        .timeline { width: 100%; -webkit-appearance: none; appearance: none; height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; cursor: pointer; background-image: linear-gradient(var(--accent-color), var(--accent-color)); background-size: 0% 100%; background-repeat: no-repeat; }
        .timeline::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; background: white; border-radius: 50%; cursor: pointer; margin-top: -5px; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .time-display { display: flex; justify-content: space-between; font-size: 0.8em; color: var(--secondary-text-color); font-family: 'Courier New', monospace; }
        
        .volume-control { position: relative; }
        .volume-btn { background: transparent; border: none; cursor: pointer; display: flex; }
        .volume-btn svg { width: 24px; height: 24px; fill: var(--secondary-text-color); transition: all 0.2s ease; }
        .volume-btn:hover svg { fill: var(--accent-color); }
        .volume-slider-container { position: absolute; bottom: 40px; right: -12px; background: #2a2a3f; padding: 15px 12px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); visibility: hidden; opacity: 0; transition: all 0.2s ease; z-index: 10; }
        .volume-control.active .volume-slider-container, .volume-control:hover .volume-slider-container { visibility: visible; opacity: 1; }
        .volume-slider { writing-mode: bt-lr; -webkit-appearance: none; appearance: none; width: 8px; height: 100px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: var(--accent-color); border-radius: 50%; cursor: pointer; }

        .disclaimer, footer { max-width: 720px; width: 100%; }
        .disclaimer { text-align: left; padding: 20px; margin-top: 40px; border-top: 1px solid var(--border-color); color: #888; font-size: 0.8em; line-height: 1.6; }
        footer { text-align: center; margin-top: 20px; color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/sevenup3.png" alt="Logo Coro" class="header-logo">
        <h1 class="main-title">Misatango 7.06.2025</h1>
        <p class="concert-location">Basilica Concattedrale Santa Maria Annunziata e San Vicinio (Sarsina)</p>
        
        <div class="concert-info">
             <p><strong>Cori:</strong> Alio Modo Canticum & Lirico Città di Faenza</p>
             <p><strong>Solista (Mezzosoprano):</strong> Ada Piatti</p>
             <p><strong>Direttore:</strong> Andrea Crastolla</p>
        </div>

        <div class="playlist-controls-wrapper">
             <div class="playlist-controls">
                <button id="playlist-prev" title="Precedente"><svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></svg></button>
                <button id="playlist-play-pause" title="Avvia/Pausa"><svg class="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg><svg class="icon-pause" style="display:none;" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button>
                <button id="playlist-stop" title="Ferma"><svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"></path></svg></button>
                <button id="playlist-next" title="Successivo"><svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"></path></svg></button>
             </div>
        </div>
        
        <!-- I BRANI SARANNO GENERATI QUI DA JAVASCRIPT -->
        <div id="playlist-container"></div>
    </div>
    
    <div class="disclaimer">
        <!-- disclaimer content -->
    </div>
    <footer id="footer-text"></footer>

    <!-- Template per la singola card di un brano -->
    <template id="brano-template">
        <div class="brano" style="opacity:0"> <!-- Animazione gestita da JS -->
            <h2></h2>
            <div class="custom-player">
                <button class="play-pause-btn" title="Play/Pausa">
                    <svg class="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
                    <svg class="icon-pause" style="display: none;" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                </button>
                <div class="player-center">
                    <input type="range" class="timeline" value="0" step="1">
                    <div class="time-display"><span class="current-time">0:00</span><span class="duration">0:00</span></div>
                </div>
                <div class="volume-control">
                    <button class="volume-btn" title="Volume">
                        <svg class="icon-volume-high" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                    </button>
                    <div class="volume-slider-container"><input type="range" class="volume-slider" min="0" max="1" step="0.05" value="1"></div>
                </div>
            </div>
            <audio preload="metadata"></audio>
        </div>
    </template>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const songData = [ // Ora è un array per mantenere l'ordine
                { id: "kyrie", title: "Introitus et Kyrie", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/1.%20Introitus%20et%20Kyrie%20.mp3"},
                { id: "gloria", title: "Gloria", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/2.%20Gloria%20.mp3"},
                { id: "credo", title: "Credo", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/3.%20Credo%20.mp3"},
                { id: "sanctus", title: "Sanctus", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/4.%20Sanctus%20.mp3"},
                { id: "benedictus", title: "Benedictus", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/5.%20Benedictus%20.mp3"},
                { id: "agnusdei", title: "Agnus Dei", url: "https://raw.githubusercontent.com/SevenUp88/Alio-Modo-Canticum/main/Concerti/2025/Misatango%20-%207.06.25/6.%20Agnus%20Dei%20.mp3"},
            ];

            const playlistContainer = document.getElementById('playlist-container');
            const template = document.getElementById('brano-template');

            // --- INIZIALIZZAZIONE DELL'APP ---
            songData.forEach((song, index) => {
                const clone = template.content.cloneNode(true);
                const brano = clone.querySelector('.brano');
                const audio = clone.querySelector('audio');
                
                brano.style.animationDelay = `${index * 0.1}s`;
                clone.querySelector('h2').textContent = song.title;
                audio.src = song.url;
                
                initializePlayer(clone);
                playlistContainer.appendChild(clone);
            });
            
            const audioPlayers = Array.from(document.querySelectorAll('audio'));
            const playPauseBtn = document.getElementById('playlist-play-pause');
            const mainIconPlay = playPauseBtn.querySelector('.icon-play');
            const mainIconPause = playPauseBtn.querySelector('.icon-pause');
            const stopBtn = document.getElementById('playlist-stop');
            const nextBtn = document.getElementById('playlist-next');
            const prevBtn = document.getElementById('playlist-prev');

            let currentAudio = audioPlayers[0];
            let isConcertMode = false;
            const SAVED_VOLUME_KEY = 'SevernUpPlayerVolume';

            // La regola ferrea
            document.addEventListener('play', (e) => {
                audioPlayers.forEach(audio => { if (audio !== e.target) audio.pause(); });
            }, true);

            function formatTime(s) { const m=Math.floor(s/60),n=Math.floor(s%60); return `${m}:${n.toString().padStart(2,'0')}`; }

            function initializePlayer(playerNode) {
                 const audio = playerNode.querySelector('audio');
                 const playBtn = playerNode.querySelector('.play-pause-btn');
                 const iconPlay = playBtn.querySelector('.icon-play');
                 const iconPause = playBtn.querySelector('.icon-pause');
                 const timeline = playerNode.querySelector('.timeline');
                 const volumeSlider = playerNode.querySelector('.volume-slider');
                 const currentTimeEl = playerNode.querySelector('.current-time');
                 const durationEl = playerNode.querySelector('.duration');
                
                 playBtn.addEventListener('click', () => audio.paused ? audio.play() : audio.pause());

                 audio.addEventListener('play', () => { iconPause.style.display = 'block'; iconPlay.style.display = 'none'; updateUI(); });
                 audio.addEventListener('pause', () => { iconPause.style.display = 'none'; iconPlay.style.display = 'block'; updateUI(); });

                 audio.addEventListener('loadedmetadata', () => { timeline.max = audio.duration; durationEl.textContent = formatTime(audio.duration); });
                 audio.addEventListener('timeupdate', () => {
                     const percent = (audio.currentTime / audio.duration) * 100;
                     timeline.value = audio.currentTime;
                     timeline.style.backgroundSize = `${percent}% 100%`;
                     currentTimeEl.textContent = formatTime(audio.currentTime);
                 });
                 timeline.addEventListener('input', () => audio.currentTime = timeline.value);
                 
                 volumeSlider.addEventListener('input', (e) => { audio.volume = e.target.value; localStorage.setItem(SAVED_VOLUME_KEY, audio.volume); });
                 const savedVolume = localStorage.getItem(SAVED_VOLUME_KEY);
                 if(savedVolume) audio.volume = savedVolume;
                 volumeSlider.value = audio.volume;
                 
                 audio.addEventListener('ended', () => { if (isConcertMode) changeTrack(1); });
            }

            function playTrack(index) {
                if (index < 0) index = audioPlayers.length - 1;
                if (index >= audioPlayers.length) { stopHard(); return; }
                
                currentAudio = audioPlayers[index];
                isConcertMode = true;
                currentAudio.play();
            }

            function changeTrack(direction) {
                let currentIndex = audioPlayers.indexOf(currentAudio);
                playTrack(currentIndex + direction);
            }
            
            function stopHard() {
                isConcertMode = false;
                audioPlayers.forEach(p => { p.pause(); p.currentTime = 0; });
                updateUI();
            }
            
            function updateUI() {
                const isPlaying = currentAudio && !currentAudio.paused;
                mainIconPlay.style.display = isPlaying ? 'none' : 'block';
                mainIconPause.style.display = isPlaying ? 'block' : 'none';
                
                document.querySelectorAll('.brano.is-playing').forEach(el => el.classList.remove('is-playing'));
                if (isPlaying) currentAudio.closest('.brano').classList.add('is-playing');
            }

            // GESTIONE CONTROLLI PRINCIPALI
            playPauseBtn.addEventListener('click', () => {
                 if (currentAudio.paused) playTrack(isConcertMode ? audioPlayers.indexOf(currentAudio) : 0);
                 else currentAudio.pause();
            });
            stopBtn.addEventListener('click', stopHard);
            nextBtn.addEventListener('click', () => changeTrack(1));
            prevBtn.addEventListener('click', () => changeTrack(-1));
            
            // FOOTER E DISCLAIMER
             document.getElementById('footer-text').innerHTML = `© ${new Date().getFullYear()} SevernUp Recordings`;
             // Inserire qui il resto del codice JS che non dipende dai player...
        });
    </script>
</body>
</html>
